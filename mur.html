<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mur ‚Äì Plan√®te C≈ìurs</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff0f5;
      margin: 0;
      padding: 0;
    }

    header {
      background: #ff69b4;
      color: white;
      padding: 1em;
      text-align: center;
      font-size: 1.4em;
      font-weight: bold;
    }

    nav {
      display: flex;
      justify-content: center;
      background-color: #ffe4e1;
      padding: 0.5em;
      gap: 2em;
    }

    nav a {
      color: #d63384;
      font-weight: bold;
      text-decoration: none;
    }

    .container {
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    textarea {
      width: 100%;
      border-radius: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      resize: vertical;
    }

    input[type="file"] {
      margin-top: 10px;
    }

    button {
      background: #ff69b4;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      margin-top: 10px;
      cursor: pointer;
    }

    .post {
      border-top: 1px solid #eee;
      margin-top: 20px;
      padding-top: 15px;
    }

    .post img {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }

    .actions {
      margin-top: 10px;
    }

    .actions button {
      background: none;
      border: none;
      color: #d63384;
      cursor: pointer;
      margin-right: 10px;
    }
  </style>
</head>
<body>

<header>‚ù§Ô∏è Plan√®te C≈ìurs ‚Äì Mur romantique</header>

<nav>
  <a href="index.html">Accueil</a>
  <a href="profil.html">Profil</a>
  <a href="parametres.html">Param√®tres</a>
  <a href="#" onclick="logout()">D√©connexion</a>
</nav>

<div class="container">
  <h3>Exprimez vos pens√©es romantiques...</h3>
  <textarea id="message" rows="3" placeholder="√âcrivez ici..."></textarea>
  <input type="file" id="image">
  <button onclick="publier()">Publier</button>

  <div id="mur"></div>
</div>

<script>
  // Configuration Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBWMGsMl7Uyqx5mimLiR_lv_u_WCeaU_jY",
    authDomain: "planetes-coeurs-site.firebaseapp.com",
    projectId: "planetes-coeurs-site",
    storageBucket: "planetes-coeurs-site.appspot.com",
    messagingSenderId: "433372689765",
    appId: "1:433372689765:web:8e1e6ae2b776875a329d8c",
    measurementId: "G-SMZTEG955E"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  // Publier un post
  async function publier() {
    const user = auth.currentUser;
    if (!user) return alert("Veuillez vous connecter");
    const message = document.getElementById("message").value;
    const imageFile = document.getElementById("image").files[0];
    let imageURL = "";

    if (imageFile) {
      const ref = storage.ref('images/' + Date.now() + '_' + imageFile.name);
      await ref.put(imageFile);
      imageURL = await ref.getDownloadURL();
    }

    await db.collection("posts").add({
      uid: user.uid,
      message: message,
      imageURL: imageURL,
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      likes: 0,
      commentaires: []
    });

    document.getElementById("message").value = "";
    document.getElementById("image").value = "";
    chargerPosts();
  }

  // Charger les publications
  function chargerPosts() {
    db.collection("posts").orderBy("createdAt", "desc").onSnapshot(snapshot => {
      const mur = document.getElementById("mur");
      mur.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <p>${data.message}</p>
          ${data.imageURL ? `<img src="${data.imageURL}">` : ""}
          <div class="actions">
            <button onclick="likePost('${doc.id}')">‚ù§Ô∏è Like</button>
            <button onclick="commenterPost('${doc.id}')">üí¨ Commenter</button>
            <button onclick="partagerPost('${doc.id}')">üîÑ Partager</button>
          </div>
        `;
        mur.appendChild(div);
      });
    });
  }

  function likePost(id) {
    const postRef = db.collection("posts").doc(id);
    postRef.update({ likes: firebase.firestore.FieldValue.increment(1) });
  }

  function commenterPost(id) {
    const commentaire = prompt("Votre commentaire :");
    if (!commentaire) return;
    const postRef = db.collection("posts").doc(id);
    postRef.update({
      commentaires: firebase.firestore.FieldValue.arrayUnion(commentaire)
    });
  }

  function partagerPost(id) {
    alert("Lien de la publication copi√© !");
    // Ici, tu pourrais g√©n√©rer un lien r√©el √† partager
  }

  function logout() {
    firebase.auth().signOut().then(() => {
      location.href = "index.html";
    });
  }

  // Attendre que l‚Äôutilisateur soit connect√©
  auth.onAuthStateChanged(user => {
    if (user) {
      chargerPosts();
    } else {
      location.href = "login.html";
    }
  });
</script>

</body>
</html>
