<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paramètres - Planète Cœurs</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffe6f2;
      text-align: center;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #d6336c;
    }
    input, select, button {
      margin: 10px 0;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 80%;
    }
    button {
      background-color: #d6336c;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #b82e5c;
    }
    a {
      color: #d6336c;
      text-decoration: none;
      display: block;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Paramètres ⚙️</h1>

  <h3>Confidentialité</h3>
  <select id="privacy">
    <option value="public">Profil Public</option>
    <option value="private">Profil Privé</option>
  </select>
  <br>
  <button onclick="savePrivacy()">Enregistrer</button>

  <h3>Changer le mot de passe</h3>
  <input type="password" id="new-password" placeholder="Nouveau mot de passe">
  <button onclick="changePassword()">Changer</button>

  <h3>Badge de vérification</h3>
  <input type="file" id="selfie" accept="image/*">
  <button onclick="verifyBadge()">Vérifier</button>

  <h3>Langue</h3>
  <select id="language">
    <option value="fr">Français</option>
    <option value="en">English</option>
  </select>
  <br>
  <button onclick="saveLanguage()">Enregistrer</button>

  <h3>Notifications</h3>
  <select id="notifications">
    <option value="enabled">Activées</option>
    <option value="disabled">Désactivées</option>
  </select>
  <br>
  <button onclick="saveNotifications()">Mettre à jour</button>

  <h3>Supprimer mon compte</h3>
  <button onclick="deleteAccount()">Supprimer définitivement</button>

  <h3>Déconnexion</h3>
  <button onclick="logout()">Se déconnecter</button>

  <a href="home.html">⬅️ Retour à l'accueil</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getAuth, onAuthStateChanged, updatePassword, deleteUser, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDU5mzsxsDAa2tmq9fwQcf-DD7rNY9riU8",
  authDomain: "planete-coeur.firebaseapp.com",
  projectId: "planete-coeur",
  storageBucket: "planete-coeur.appspot.com",
  messagingSenderId: "124827847585",
  appId: "1:124827847585:web:64b56079fcafdd61f5d9e0",
  measurementId: "G-2SBTXBB67B"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

let currentUser = null;

onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
  } else {
    alert("Vous devez être connecté !");
    window.location.href = "index.html";
  }
});

window.savePrivacy = async () => {
  const privacy = document.getElementById("privacy").value;
  await updateDoc(doc(db, "users", currentUser.uid), { privacy });
  alert("Confidentialité mise à jour !");
};

window.changePassword = () => {
  const newPassword = document.getElementById("new-password").value;
  if (!newPassword) {
    alert("Veuillez entrer un nouveau mot de passe.");
    return;
  }
  updatePassword(currentUser, newPassword).then(() => {
    alert("Mot de passe changé !");
  }).catch(err => {
    alert("Erreur : " + err.message);
  });
};

window.verifyBadge = () => {
  const file = document.getElementById("selfie").files[0];
  if (!file) {
    alert("Veuillez choisir une photo.");
    return;
  }
  const storageRef = ref(storage, `badges/${currentUser.uid}.jpg`);
  uploadBytes(storageRef, file).then(() => {
    alert("Selfie envoyé pour vérification.");
  });
};

window.saveLanguage = async () => {
  const language = document.getElementById("language").value;
  await updateDoc(doc(db, "users", currentUser.uid), { language });
  alert("Langue mise à jour !");
};

window.saveNotifications = async () => {
  const notifications = document.getElementById("notifications").value;
  await updateDoc(doc(db, "users", currentUser.uid), { notifications });
  alert("Paramètre de notification mis à jour !");
};

window.deleteAccount = () => {
  if (confirm("Êtes-vous sûr de vouloir supprimer votre compte ?")) {
    deleteUser(currentUser).then(() => {
      alert("Compte supprimé.");
      window.location.href = "index.html";
    }).catch(err => {
      alert("Erreur : " + err.message);
    });
  }
};

window.logout = () => {
  signOut(auth).then(() => {
    window.location.href = "index.html";
  }).catch((error) => {
    alert("Erreur : " + error.message);
  });
};
</script>

</body>
</html>
